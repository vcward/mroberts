<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Michael J. Roberts</title>
  <!-- Bootstrap -->
  <link href="../css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link href="../css/styles.css" rel="stylesheet">
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  <style>
    .selection {
      margin-right: 5px;
      margin-bottom: 10px;
    }

    .selection>select {
      width: 100%;
    }

    #graph {
      margin-bottom: 20px;
    }

    .summary-stats .stat {
      margin-bottom: 25px;
      color: #31708F;
    }

    .summary-stats .stat>p {
      color: #000;
    }

    .summary-stats hr {
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <!-- NAVIGATION BEGIN -->
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle hidden-lg-up pull-left" data-toggle="collapse"
          data-target="#nav-collapse" aria-expanded="false">
          <span class="sr-only">Toggle Navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Michael J. Roberts</a>
      </div>

      <div class="collapse navbar-collapse navbar-toggleable-md" id="nav-collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="../publications.html">Publications</a></li>
          <li><a href="../workingpapers.html">Working Papers</a></li>
          <li><a href="../outreach.html">Outreach</a></li>
          <li><a href="../coauthors.html">Coauthors</a></li>
          <li><a href="../links.html">Links</a></li>
          <li><a href="http://uhero.hawaii.edu/145">WEER</a></li>
          <li><a href="http://seagrant.soest.hawaii.edu">UH Sea Grant</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- END NAVIGATION -->

  <!-- BEGIN PAGE CONTENT -->
  <div class="container-fluid">
    <div class="row">
      <div class="col-xs-12">
        <div class="selection">
          <label for="eei">Energy Efficiency Improvement
            <a href="#" data-toggle="tooltip" data-placement="bottom" title="
            the amount of electricity demand reduction with efficiency improvement by 2039">
              <i class="fa fa-question-circle-o" aria-hidden="true"></i>
            </a>
          </label>
          <select name="eei" id="eei">
            <option value="00L">0%</option>
            <option value="10L">10%</option>
            <option value="20L">20%</option>
            <option value="30L">30%</option>
          </select>
        </div>
        <div class="selection">
          <label for="ec">Energy Charge
            <a href="#" data-toggle="tooltip" data-placement="bottom" title="The high scenario is based on the EIA forecast.
            The mid scenario is based on crude oil futures prices.
            The low scenario is based on the prices 1SD lower than crude oil futures prices.
              ">
              <i class="fa fa-question-circle-o" aria-hidden="true"></i>
            </a>
          </label>
          <select name="ec" id="ec">
            <option value="EC2">High</option>
            <option value="EC1" selected="selected">Mid</option>
            <option value="EC3">Low</option>
          </select>
        </div>
        <div class="selection">
          <label for="nec">Non-Energy Charge
            <a href="#" data-toggle="tooltip" title-align:"left" data-placement="bottom" title="
            the part of the electricity bill from HECO, not included in the Energy Charge.
            0% grid defection indicates HECO's system demand stays the same as the level in 2018.
            30% grid defection indicates the system demand will drop by 30% until 2039">
              <i class="fa fa-question-circle-o" aria-hidden="true"></i>
            </a>
          </label>
          <select name="nec" id="nec">
            <option value="NEC0">0% Grid Defection</option>
            <option value="NEC1">30% Grid Defection</option>
          </select>
        </div>
        <div class="selection">
          <label for="pv">on-campus PV
          <a href="#" data-toggle="tooltip" data-placement="bottom" title="
          The model is set to install 5 MW PV by 2025,
          another 5 MW PV by 2030, and 2 MW PV by 2035 on the Manoa campus">
            <i class="fa fa-question-circle-o" aria-hidden="true"></i>
          </a>
        </label>
          <select name="pv" id="pv">
            <option value="PV0">0MW</option>
            <option value="PV1" selected="selected">12MW</option>
          </select>
        </div>
        <div class="selection">
          <label for="5mw">on-campus 5MW PV with PPA
            <a href="#" data-toggle="tooltip" data-placement="bottom" title="
            With the PPA, the UH can install PV on the campus without paying
            installation and maintenance costs. But, the UH needs to purchase
            electricity at the contracted prices, 17 cents/kWh">
              <i class="fa fa-question-circle-o" aria-hidden="true"></i>
            </a>
          </label>
          <select name="5mw" id="5mw">
            <option value="PPA0">No</option>
            <option value="PPA1" selected="selected">17cents/kWh</option>
          </select>
        </div>
        <div class="selection">
          <label for="cpp">Cogeneration Plant</label>
          <select name="cpp" id="cpp">
            <option value="CG0" selected="selected">No</option>
            <option value="CG1">Yes (no enforcement)</option>
            <option value="CG4">Yes (PPA= 14 cents/kWh)</option>
          </select>
        </div>
        <div class="selection">
          <label for="gt">Green Tariff
            <a href="#" data-toggle="tooltip" data-placement="bottom" class="left" title="
            10 MW PV will be installed on UH’s land in West Oahu by 2025.
            'GT program only' option indicates the green tariff program without
            a virtual rider M option (VRM). 'GT program with VRM' option indicates
            the UH decides to add VRM in the green tariff program">
              <i class="fa fa-question-circle-o" aria-hidden="true"></i>
            <a>
          </label>
          <select name="gt" id="gt">
            <option value="WO0_VRM0" selected="selected">No</option>
            <option value="WO1_VRM0">GT alone (GTRate: 10cents/kWh)</option>
            <option value="WO1_VRM1">GT with VRM (GTRate: 10cents/kWh)</option>
          </select>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12" id="figures">
      </div>
    </div>

    <label for="NPV"> Net Present Value (NPV)= The NPV indicates the amount of total cost
      savings from on and off-campus investments. It is calculated by subtracting the total
      costs (electricity bill + other installation costs) of the considered scenario from
      the costs of the status-quo scenario. The NPV of the baseline scenario denotes the
      saving when the UH decides to implement only the on-campus investment (17 MW PV + battery).
  </div>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="../js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/tether/1.4.3/js/tether.min.js"></script>
  <script src="../js/jquery.csv.min.js"></script>
  <script src="https://use.fontawesome.com/5d5327427a.js"></script>
  <script>
    const createFilePostfix = () => {
      let namePostfix = ''
      $('select').each(function (index, s) {
        namePostfix += `_${$(s).val()}`;
      });
      return namePostfix;
    };

    const filePrefixes = {
      csv: 'cap',
      avgMonthlyBill: 'avg_bill',
      percGen: 'pie',
      hourlyLoadHigh: 'LB',
      billStruc: 'bill_struc',
      npv: 'NPV'
    };

    const fileDisplayOrder = [
      { file: 'csv', title: 'Cumulated Power Capacity On-campus (MW)' },
      { file: 'avgMonthlyBill', title: 'Projected Annual Average Monthly Bill' },
      { file: 'percGen', title: 'Energy Mix in 2039' },
      { file: 'hourlyLoadHigh', title: 'Hourly Load Balance' },
      { file: 'billStruc', title: 'Structure of the Bill' },
      { file: 'npv', title: 'Net Present Value' }
    ];


    const createFileNames = (prefixes, postfix) => {
      return Object.keys(prefixes).reduce((result, key) => {
        result[key] = prefixes[key] + postfix;
        return result;
      }, {});
    }

    function createTable(container, csvData) {
      const table = document.createElement('table');
      table.classList.add('table')
      container.appendChild(table);
      const thead = document.createElement('thead');
      table.appendChild(thead);
      const tbody = document.createElement('tbody');
      table.appendChild(tbody);
      csvData.forEach((row, index) => {
        if (index === 0) {
          createTableHeader(thead, row);
        }
        if (index !== 0) {
          createTableRows(tbody, row);
        }
      });
    }

    function createTableHeader(thead, row) {
      row.forEach((cell) => {
        const th = document.createElement('th');
        const cellText = document.createTextNode(cell);
        th.appendChild(cellText)
        thead.appendChild(th);
      });
    }

    function createTableRows(tbody, row) {
      const tr = document.createElement('tr');
      row.forEach((cell) => {
        const td = document.createElement('td');
        const cellText = document.createTextNode(cell);
        td.appendChild(cellText);
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    }

    function displayNoFileMsg(container) {
      const pWarning = document.createElement('p');
      const warning = document.createTextNode('Not available for current selection.')
      pWarning.appendChild(warning);
      container.appendChild(pWarning);
    }

    function removeOldFigures(figureContainer) {
      while (figureContainer.firstChild) {
        figureContainer.removeChild(figureContainer.firstChild)
      }
    }

    function loadCSVData(fileName, container) {
      $.get(fileName, function (data, textStatus) {
        if (textStatus === 'success') {
          const csvData = $.csv.toArrays(data);
          createTable(container, csvData);
        }
      }).fail(function () {
        displayNoFileMsg(container);
      });
    }

    function embedGraphs(fileName, container) {
      $.get(fileName, function (data, textStatus) {
        if (textStatus === 'success') {
          const embed = document.createElement('embed');
          embed.setAttribute('src', fileName);
          embed.setAttribute('height', '450px');
          embed.setAttribute('width', '100%');
          container.appendChild(embed);
        }
      }).fail(function () {
        displayNoFileMsg(container);
      });
    }

    function displayFigures(files, displayOrder) {
      const figureContainer = document.getElementById('figures');
      removeOldFigures(figureContainer);
      displayOrder.forEach((d) => {
        const container = document.createElement('div');
        container.classList.add('col-xs-12', 'col-md-4');
        const pTitle = document.createElement('p');
        pTitle.setAttribute('style', 'font-weight: bold;');
        const title = document.createTextNode(d.title);
        pTitle.appendChild(title);
        container.appendChild(pTitle);
        if (d.file === 'csv') {
          const csvFileName = `./${files[d.file]}.csv`;
          loadCSVData(csvFileName, container);
        }
        if (d.file !== 'csv') {
          const pdfFileName = `./${files[d.file]}.pdf`;
          embedGraphs(pdfFileName, container);
        }
        figureContainer.appendChild(container);
      });
    }

    const defaultPostfix = createFilePostfix();
    const defaultFiles = createFileNames(filePrefixes, defaultPostfix);
    displayFigures(defaultFiles, fileDisplayOrder)
    $('select').change(function () {
      const newPostfix = createFilePostfix();
      const newFiles = createFileNames(filePrefixes, newPostfix);
      displayFigures(newFiles, fileDisplayOrder)
    });

    $(function () {
      $('[data-toggle="tooltip"]').tooltip()
    });
  </script>
</body>

</html>
